@* @model SMS.Models.ViewModels.AllShipmentsVM *@
@* *@
@* @{ *@
@*     ViewData["Title"] = "All Shipments"; *@
@*     Layout = "~/Views/Shared/AdminLTE/_Layout.cshtml"; *@
@* } *@
@* *@
@* <div class="card shadow mb-4"> *@
@*     <div class="card-header"> *@
@*         <h6 class="m-0 font-weight-bold text-primary">All Created Shipments (Regular & Merchant)</h6> *@
@*     </div> *@
@* *@
@*     <!-- NEW: Date Range Filter Form --> *@
@*     <div class="card-body border-bottom"> *@
@*         <form asp-action="AllShipments" asp-controller="Dashboard" method="get"> *@
@*             <div class="row align-items-end"> *@
@*                 <div class="form-group col-md-4"> *@
@*                     <label asp-for="StartDate"></label> *@
@*                     <input asp-for="StartDate" class="form-control" /> *@
@*                 </div> *@
@*                 <div class="form-group col-md-4"> *@
@*                     <label asp-for="EndDate"></label> *@
@*                     <input asp-for="EndDate" class="form-control" /> *@
@*                 </div> *@
@*                 <div class="form-group col-md-4"> *@
@*                     <button type="submit" class="btn btn-primary">Filter Shipments</button> *@
@*                     <a asp-action="AllShipments" asp-controller="Dashboard" class="btn btn-secondary">Today's Shipments</a> *@
@*                 </div> *@
@*             </div> *@
@*         </form> *@
@*     </div> *@
@* *@
@*     <div class="card-body"> *@
@*         <table class="table table-bordered" id="allShipmentsTable"> *@
@*             <thead> *@
@*             <tr> *@
@*                 <th>Waybill #</th> *@
@*                 <th>Date</th> *@
@*                 <th>Type</th> *@
@*                 <th>Departure</th> *@
@*                 <th>Sender</th> *@
@*                 <th>Receiver</th> *@
@*                 <th>Destination</th> *@
@*                 <th>Total Cost</th> *@
@*                 <th>Status</th> *@
@*                 <th>Actions</th> *@
@*             </tr> *@
@*             </thead> *@
@*             <tbody> *@
@*             @foreach (var item in Model.Shipments) *@
@*             { *@
@*                 <tr> *@
@*                     <td>@item.WaybillNumber</td> *@
@*                     <td>@item.DateCreated.ToString("yyyy-MM-dd HH:mm")</td> *@
@*                     <td> *@
@*                         @if (item.ShipmentType == "Merchant") { *@
@*                             <span class="badge badge-success">@item.ShipmentType</span> *@
@*                         } else { *@
@*                             <span class="badge badge-secondary">@item.ShipmentType</span> *@
@*                         } *@
@*                     </td> *@
@*                     <td>@item.Departure</td> *@
@*                     <td>@item.SenderName</td> *@
@*                     <td>@item.ReceiverName</td> *@
@*                     <td>@item.Destination</td> *@
@*                     <td>@item.TotalCost.ToString("C")</td> *@
@*                     <td><span class="badge badge-info">@item.Status</span></td> *@
@*                     <td> *@
@*                         @{ var controller = item.ShipmentType == "Merchant" ? "MerchantShipment" : "Shipment"; } *@
@*                         <a asp-controller="@controller" asp-action="Waybill" asp-route-id="@item.Id" class="btn btn-sm btn-primary" target="_blank">View Waybill</a> *@
@*                     </td> *@
@*                 </tr> *@
@*             } *@
@*             </tbody> *@
@*         </table> *@
@*     </div> *@
@* </div> *@
@* *@
@* @section Scripts { *@
@*     <script> *@
@*         $(document).ready(function() { *@
@*             // Initialize DataTable, but disable its default ordering *@
@*             // so the server-side ordering is preserved. *@
@*             $('#allShipmentsTable').DataTable({ *@
@*                 "order": [] *@
@*             }); *@
@*         }); *@
@*     </script> *@
@* } *@







@model SMS.Models.ViewModels.AllShipmentsVM

@{
    ViewData["Title"] = "All Shipments";
    Layout = "~/Views/Shared/AdminLTE/_Layout.cshtml";
}

<div class="card shadow mb-4">
    <div class="card-header">
        <h6 class="m-0 font-weight-bold text-primary">All Created Shipments (Regular & Merchant)</h6>
    </div>

    <!-- Date Filter Form (remains the same) -->
    <div class="card-body border-bottom">
        <form asp-action="AllShipments" method="get">
            <div class="row align-items-end">
                <div class="form-group col-md-4"><label asp-for="StartDate"></label><input asp-for="StartDate" class="form-control" /></div>
                <div class="form-group col-md-4"><label asp-for="EndDate"></label><input asp-for="EndDate" class="form-control" /></div>
                <div class="form-group col-md-2"><button type="submit" class="btn btn-primary btn-block">Filter</button></div>
                <div class="form-group col-md-2"><a asp-action="AllShipments" class="btn btn-secondary btn-block">Today's Shipments</a></div>
            </div>
        </form>
    </div>

    <div class="card-body">
        <table class="table table-bordered" id="allShipmentsTable">
            <thead>
                <tr>
                    <th>Waybill #</th>
                    <th>Date</th>
                    <th>Type</th>
                    <th>Departure</th>
                    <th>Sender</th>
                    <th>Receiver</th>
                    <th>Destination</th>
                    <th>Total Cost</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.Shipments)
                {
                    <tr>
                        <td>@item.WaybillNumber</td>
                        <td>@item.DateCreated.ToString("yyyy-MM-dd HH:mm")</td>
                        <td>
                            @if (item.ShipmentType == "Merchant") { <span class="badge badge-success">@item.ShipmentType</span> }
                            else { <span class="badge badge-secondary">@item.ShipmentType</span> }
                        </td>
                        <td>@item.Departure</td>
                        <td>@item.SenderName</td>
                        <td>@item.ReceiverName</td>
                        <td>@item.Destination</td>
                        <td>@item.TotalCost.ToString("C")</td>
                        <td><span class="badge badge-info">@item.Status</span></td>
                        <td>
                            @{ var controller = item.ShipmentType == "Merchant" ? "MerchantShipment" : "Shipment"; }
                            <a asp-controller="@controller" asp-action="Waybill" asp-route-id="@item.Id" class="btn btn-sm btn-primary" target="_blank">View Waybill</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
<script>
    $(document).ready(function() {
        // --- UPDATED DATATABLE INITIALIZATION ---
        // 'Bfrtip' is the key: B=Buttons, f=filtering input, r=processing display, t=table, i=table information, p=pagination.
        $('#allShipmentsTable').DataTable({
            "order": [[ 1, "desc" ]],
            dom: 'Bfrtip',
            buttons: [
                'copy', 'csv', 'excel', 'pdf', 'print'
            ]
        });
    });
</script>
}
