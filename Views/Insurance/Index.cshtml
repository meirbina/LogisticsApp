@model IEnumerable<SMS.Models.Insurance>
@{
    ViewData["Title"] = "Insurance Setup";
    Layout = "~/Views/Shared/AdminLTE/_Layout.cshtml";
}

<div class="card shadow mb-4">
    <div class="card-header py-3 d-flex justify-content-between">
        <h6 class="m-0 font-weight-bold text-primary">Insurance Setup</h6>
        <button class="btn btn-primary" data-toggle="modal" data-target="#addModal">Add Insurance</button>
    </div>
    <div class="card-body">
        <table class="table table-bordered" id="insuranceTable">
            <thead><tr><th>ID</th><th>Insurance Name</th><th>Amount (%)</th><th>Actions</th></tr></thead>
            <tbody>
            @foreach (var item in Model) {
                <tr>
                    <td>@item.Id</td>
                    <td>@item.Name</td>
                    <td>@item.Amount%</td>
                    <td>
                        <button class="btn btn-sm btn-warning edit-btn" data-id="@item.Id">Edit</button>
                        <button class="btn btn-sm btn-danger delete-btn" data-id="@item.Id">Delete</button>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
</div>

<!-- Add Modal -->
<div class="modal fade" id="addModal"><div class="modal-dialog"><div class="modal-content">
            <form asp-action="Create" method="post">
                <div class="modal-header"><h5 class="modal-title">Add Insurance</h5></div>
                <div class="modal-body">
                    <div class="form-group"><label>Enter Insurance Name</label><input name="Name" class="form-control" required/></div>
                    <div class="form-group"><label>Amount (Rate %)</label><input name="Amount" type="number" step="0.01" class="form-control" required/></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button><button type="submit" class="btn btn-primary">Submit</button></div>
            </form>
        </div></div></div>

<!-- Edit Modal -->
<div class="modal fade" id="editModal"><div class="modal-dialog"><div class="modal-content">
            <form asp-action="Edit" method="post">
                <div class="modal-header"><h5 class="modal-title">Edit Insurance</h5></div>
                <div class="modal-body">
                    <input type="hidden" id="editId" name="Id" />
                    <div class="form-group"><label>Insurance Name</label><input id="editName" name="Name" class="form-control" required/></div>
                    <div class="form-group"><label>Amount (Rate %)</label><input id="editAmount" name="Amount" type="number" step="0.01" class="form-control" required/></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button><button type="submit" class="btn btn-primary">Update</button></div>
            </form>
        </div></div></div>

<!-- Delete Modal -->
<div class="modal fade" id="deleteModal"><div class="modal-dialog"><div class="modal-content">
            <form asp-action="Delete" method="post">
                <div class="modal-header"><h5 class="modal-title">Confirm Deletion</h5></div>
                <div class="modal-body"><p>Are you sure you want to delete this insurance rate?</p><input type="hidden" id="deleteId" name="id" /></div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button><button type="submit" class="btn btn-danger">Delete</button></div>
            </form>
        </div></div></div>

@section Scripts {
    <script>
        $(function() {
            $('#insuranceTable').DataTable();
            $('.edit-btn').on('click', function() {
                $.getJSON('/Insurance/GetInsurance/' + $(this).data('id'), function(data) {
                    $('#editId').val(data.id);
                    $('#editName').val(data.name);
                    $('#editAmount').val(data.amount);
                    $('#editModal').modal('show');
                });
            });
            $('.delete-btn').on('click', function() {
                $('#deleteId').val($(this).data('id'));
                $('#deleteModal').modal('show');
            });
        });
    </script>
}