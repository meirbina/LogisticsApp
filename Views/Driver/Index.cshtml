@* @model IEnumerable<SMS.Models.Driver> *@
@* *@
@* @{ *@
@*     ViewData["Title"] = "Drivers List"; *@
@*     Layout = "~/Views/Shared/AdminLTE/_Layout.cshtml"; *@
@* } *@
@* *@
@* <div class="card"> *@
@*     <div class="card-header"> *@
@*         <h3 class="card-title">@ViewData["Title"]</h3> *@
@*         <div class="card-tools"> *@
@*             <a asp-action="Create" class="btn btn-primary"> *@
@*                 <i class="fas fa-plus"></i> Create New Driver *@
@*             </a> *@
@*         </div> *@
@*     </div> *@
@*     <div class="card-body"> *@
@*         <table class="table table-bordered table-striped"> *@
@*             <thead> *@
@*             <tr> *@
@*                 <th>@Html.DisplayNameFor(model => model.Name)</th> *@
@*                 <th>@Html.DisplayNameFor(model => model.PhoneNumber)</th> *@
@*                 <th>Company</th> *@
@*                 <th>Actions</th> *@
@*             </tr> *@
@*             </thead> *@
@*             <tbody> *@
@*             @foreach (var item in Model) *@
@*             { *@
@*                 <tr> *@
@*                     <td>@Html.DisplayFor(modelItem => item.Name)</td> *@
@*                     <td>@Html.DisplayFor(modelItem => item.PhoneNumber)</td> *@
@*                     <td>@Html.DisplayFor(modelItem => item.Company.Name)</td> *@
@*                     <td> *@
@*                         <div class="btn-group"> *@
@*                             <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-sm btn-info" title="Edit"><i class="fas fa-pencil-alt"></i></a> *@
@*                             <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-sm btn-success" title="Details"><i class="fas fa-list"></i></a> *@
@*                             <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-sm btn-danger" title="Delete"><i class="fas fa-trash"></i></a> *@
@*                         </div> *@
@*                     </td> *@
@*                 </tr> *@
@*             } *@
@*             </tbody> *@
@*         </table> *@
@*     </div> *@
@* </div> *@
















@model SMS.Models.ViewModels.DriverVM

@{
    ViewData["Title"] = "Drivers Setup";
    Layout = "~/Views/Shared/AdminLTE/_Layout.cshtml";
    int sl = 1;
}

<!-- Notification Area -->
@if (TempData["success"] != null) { <div class="alert alert-success alert-dismissible fade show">@TempData["success"]<button type="button" class="close" data-dismiss="alert">&times;</button></div> }
@if (TempData["error"] != null) { <div class="alert alert-danger alert-dismissible fade show">@TempData["error"]<button type="button" class="close" data-dismiss="alert">&times;</button></div> }

<div class="row">
    <!-- Left Column: Add Driver -->
    <div class="col-md-4">
        <div class="card card-primary">
            <div class="card-header"><h3 class="card-title"><i class="fas fa-plus"></i> Add New Driver</h3></div>
            <form asp-action="Create" method="post">
                @Html.AntiForgeryToken()
                <div class="card-body">
                    <div asp-validation-summary="All" class="text-danger mb-2"></div>
                    <div class="form-group">
                        <label asp-for="NewDriver.Name"></label> <span class="text-danger">*</span>
                        <input asp-for="NewDriver.Name" class="form-control" placeholder="Enter full name" />
                        <span asp-validation-for="NewDriver.Name" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="NewDriver.PhoneNumber"></label>
                        <input asp-for="NewDriver.PhoneNumber" class="form-control" placeholder="Enter phone number" />
                        <span asp-validation-for="NewDriver.PhoneNumber" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="NewDriver.CompanyId"></label> <span class="text-danger">*</span>
                        <select asp-for="NewDriver.CompanyId" class="form-control" asp-items="Model.CompanyList">
                            <option disabled selected value="">Select Company</option>
                        </select>
                        <span asp-validation-for="NewDriver.CompanyId" class="text-danger"></span>
                    </div>
                </div>
                <div class="card-footer">
                    <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Driver</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Right Column: Driver List -->
    <div class="col-md-8">
        <div class="card card-info">
            <div class="card-header"><h3 class="card-title"><i class="fas fa-list"></i> Existing Drivers List</h3></div>
            <div class="card-body">
                <table id="driverTable" class="table table-bordered table-striped">
                    <thead>
                    <tr>
                        <th>Sl</th>
                        <th>Name</th>
                        <th>Phone</th>
                        <th>Company</th>
                        <th>Action</th>
                    </tr>
                    </thead>
                    <tbody>
                    @foreach (var item in Model.DriverList)
                    {
                        <tr>
                            <td>@(sl++)</td>
                            <td>@item.Name</td>
                            <td>@item.PhoneNumber</td>
                            <td>@item.Company?.Name</td>
                            <td>
                                <div class="btn-group">
                                    <button type="button" class="btn btn-sm btn-outline-primary editButton" data-id="@item.Id" data-toggle="modal" data-target="#editModal" title="Edit"><i class="fas fa-pencil-alt"></i></button>
                                    <button type="button" class="btn btn-sm btn-outline-danger deleteButton" data-id="@item.Id" data-toggle="modal" data-target="#deleteModal" title="Delete"><i class="fas fa-trash"></i></button>
                                </div>
                            </td>
                        </tr>
                    }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- ======================= MODALS ======================= -->

<!-- Edit Modal -->
<div class="modal fade" id="editModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form asp-action="Edit" method="post">
                @Html.AntiForgeryToken()
                <input type="hidden" name="Id" id="edit_Id" />
                <div class="modal-header">
                    <h5 class="modal-title">Edit Driver Information</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Name</label>
                        <input name="Name" id="edit_Name" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input name="PhoneNumber" id="edit_PhoneNumber" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label>Company</label>
                        <select name="CompanyId" id="edit_CompanyId" class="form-control" asp-items="Model.CompanyList"></select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form asp-action="Delete" method="post">
                @Html.AntiForgeryToken()
                <div class="modal-header bg-danger"><h5 class="modal-title">Confirm Delete</h5></div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this driver?</p>
                    <input type="hidden" id="delete_Id" name="id" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger">Delete</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        $(function () {
            // Initialize DataTable for sorting, searching, etc.
            $('#driverTable').DataTable({
                "responsive": true,
                "autoWidth": false,
            });

            // Handle Edit Button Click
            $('.editButton').on('click', function () {
                var id = $(this).data('id');
                $.ajax({
                    url: `/Driver/GetDriver?id=${id}`, // Correct controller name
                    type: 'GET',
                    success: function (data) {
                        if (data) {
                            // Populate the edit modal form fields
                            $('#edit_Id').val(data.id);
                            $('#edit_Name').val(data.name);
                            $('#edit_PhoneNumber').val(data.phoneNumber);
                            $('#edit_CompanyId').val(data.companyId);
                        }
                    },
                    error: function () {
                        alert('Error fetching driver data.');
                    }
                });
            });

            // Handle Delete Button Click
            $('.deleteButton').on('click', function () {
                var id = $(this).data('id');
                // Set the hidden input value in the delete modal
                $('#delete_Id').val(id);
            });
        });
    </script>
}







