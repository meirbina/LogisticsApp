@model SMS.Models.ViewModels.LocationVM

@{
    ViewData["Title"] = "Locations";
    Layout = "~/Views/Shared/AdminLTE/_Layout.cshtml";
    int sl = 1;
}

<div class="card card-primary card-tabs">
    <div class="card-header p-0 pt-1">
        <ul class="nav nav-tabs" id="custom-tabs-one-tab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="list-tab" data-toggle="pill" href="#list-pane" role="tab" aria-controls="list-pane" aria-selected="true"><i class="fas fa-list"></i> Location List</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="create-tab" data-toggle="pill" href="#create-pane" role="tab" aria-controls="create-pane" aria-selected="false"><i class="fas fa-plus"></i> Add Location</a>
            </li>
        </ul>
    </div>
    <div class="card-body">
        <div class="tab-content" id="custom-tabs-one-tabContent">

            <div class="tab-pane fade show active" id="list-pane" role="tabpanel" aria-labelledby="list-tab">
                <table id="locationTable" class="table table-bordered table-striped">
                    <thead>
                    <tr>
                        <th>Sl</th>
                        <th>Location Name</th>
                        <th>State</th>
                        <th>Address</th>
                        <th>Type</th>
                        <th>Code</th>
                        <th>Contact Person</th>
                        <th>Action</th>
                    </tr>
                    </thead>
                    <tbody>
                    @foreach (var item in Model.LocationList)
                    {
                        <tr>
                            <td>@(sl++)</td>
                            <td>@item.Name</td>
                            <td>@item.State.Name</td>
                            <td>@item.LocationAddress</td>
                            <td>@item.LocationType</td>
                            <td>@item.LocationCode</td>
                            <td>@item.ContactPersonName</td>
                            <td>
                                <div class="btn-group">
                                    <button type="button" class="btn btn-sm btn-outline-primary editButton" data-id="@item.Id" data-toggle="modal" data-target="#editModal" title="Edit"><i class="fas fa-pencil-alt"></i></button>
                                    <button type="button" class="btn btn-sm btn-outline-danger deleteButton" data-id="@item.Id" data-toggle="modal" data-target="#deleteModal" title="Delete"><i class="fas fa-trash"></i></button>
                                </div>
                            </td>
                        </tr>
                    }
                    </tbody>
                </table>
            </div>

            <div class="tab-pane fade" id="create-pane" role="tabpanel" aria-labelledby="create-tab">
                <form asp-action="Create" method="post">
                    @Html.AntiForgeryToken()
                    <div asp-validation-summary="ModelOnly" class="text-danger mb-2"></div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label asp-for="Location.Name"></label> <span class="text-danger">*</span>
                                <input asp-for="Location.Name" class="form-control" />
                                <span asp-validation-for="Location.Name" class="text-danger"></span>
                            </div>
                            <div class="form-group">
                                <label asp-for="Location.StateId"></label> <span class="text-danger">*</span>
                                <select asp-for="Location.StateId" asp-items="Model.StateList" class="form-control"><option disabled selected>-- Select --</option></select>
                                <span asp-validation-for="Location.StateId" class="text-danger"></span>
                            </div>
                            <div class="form-group">
                                <label asp-for="Location.LocationType"></label> <span class="text-danger">*</span>
                                <select asp-for="Location.LocationType" asp-items="Model.LocationTypeList" class="form-control"><option disabled selected>-- Select --</option></select>
                                <span asp-validation-for="Location.LocationType" class="text-danger"></span>
                            </div>
                            <div class="form-group">
                                <label asp-for="Location.LocationCode"></label> <span class="text-danger">*</span>
                                <input asp-for="Location.LocationCode" class="form-control" />
                                <span asp-validation-for="Location.LocationCode" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label asp-for="Location.LocationAddress"></label>
                                <input asp-for="Location.LocationAddress" class="form-control" />
                            </div>
                            <div class="form-group">
                                <label asp-for="Location.ContactPersonName"></label>
                                <input asp-for="Location.ContactPersonName" class="form-control" />
                            </div>
                            <div class="form-group">
                                <label asp-for="Location.ContactPersonPhone"></label>
                                <input asp-for="Location.ContactPersonPhone" class="form-control" />
                            </div>
                            <div class="form-check pt-2">
                                <input asp-for="Location.IsCommissioned" class="form-check-input" type="checkbox" />
                                <label class="form-check-label" asp-for="Location.IsCommissioned"></label>
                            </div>
                        </div>
                    </div>

                    <div class="mt-3 border-top pt-3">
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Edit Modal -->
<div class="modal fade" id="editModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <form asp-action="Edit" method="post">
                @Html.AntiForgeryToken()
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-edit"></i> Edit Location</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editId" name="Id" />
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="editName">Location Name</label> <span class="text-danger">*</span>
                                <input id="editName" name="Name" class="form-control" />
                            </div>
                            <div class="form-group">
                                <label for="editStateId">State</label> <span class="text-danger">*</span>
                                <select id="editStateId" name="StateId" asp-items="Model.StateList" class="form-control"></select>
                            </div>
                            <div class="form-group">
                                <label for="editLocationType">Location Type</label> <span class="text-danger">*</span>
                                <select id="editLocationType" name="LocationType" asp-items="Model.LocationTypeList" class="form-control"></select>
                            </div>
                            <div class="form-group">
                                <label for="editLocationCode">Location Code</label> <span class="text-danger">*</span>
                                <input id="editLocationCode" name="LocationCode" class="form-control" />
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="editLocationAddress">Address</label>
                                <input id="editLocationAddress" name="LocationAddress" class="form-control" />
                            </div>
                            <div class="form-group">
                                <label for="editContactPersonName">Contact Person</label>
                                <input id="editContactPersonName" name="ContactPersonName" class="form-control" />
                            </div>
                            <div class="form-group">
                                <label for="editContactPersonPhone">Contact Person Phone</label>
                                <input id="editContactPersonPhone" name="ContactPersonPhone" class="form-control" />
                            </div>
                            <div class="form-check pt-2">
                                <input id="editIsCommissioned" name="IsCommissioned" value="true" class="form-check-input" type="checkbox" />
                                <label class="form-check-label" for="editIsCommissioned">Is Commissioned?</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary"><i class="fas fa-sync-alt"></i> Update</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form asp-action="Delete" method="post">
                @Html.AntiForgeryToken()
                <div class="modal-header">
                    <h5 class="modal-title">Confirm Deletion</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this location?</p>
                    <input type="hidden" id="deleteId" name="Id" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger">Delete</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(function () {
            $("#locationTable").DataTable({ "responsive": true, "lengthChange": false, "autoWidth": false });

            $('.editButton').on('click', function () {
                var id = $(this).data('id');
                $.getJSON('/Location/GetLocation/' + id, function (data) {
                    $('#editId').val(data.id);
                    $('#editName').val(data.name);
                    $('#editStateId').val(data.stateId);
                    $('#editLocationType').val(data.locationType);
                    $('#editLocationCode').val(data.locationCode);
                    $('#editLocationAddress').val(data.locationAddress);
                    $('#editContactPersonName').val(data.contactPersonName);
                    $('#editContactPersonPhone').val(data.contactPersonPhone);
                    $('#editIsCommissioned').prop('checked', data.isCommissioned);
                });
            });

            $('.deleteButton').on('click', function () {
                $('#deleteId').val($(this).data('id'));
            });

            @if (TempData["success"] != null)
            {
                <text>
                    $('#list-tab').tab('show');
                </text>
            }
            else if (TempData["error"] != null)
            {
                <text>
                    $('#create-tab').tab('show');
                </text>
            }
        });
    </script>
}