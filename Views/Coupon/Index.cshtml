@model IEnumerable<SMS.Models.Coupon>
@{
    ViewData["Title"] = "Coupon Setup";
    Layout = "~/Views/Shared/AdminLTE/_Layout.cshtml";
}

<div class="card shadow mb-4">
    <div class="card-header py-3 d-flex justify-content-between">
        <h6 class="m-0 font-weight-bold text-primary">Coupon Setup</h6>
        <button class="btn btn-primary" data-toggle="modal" data-target="#addModal">Add Coupon</button>
    </div>
    <div class="card-body">
        <table class="table table-bordered" id="couponTable">
            <thead><tr><th>Code</th><th>Type</th><th>Value</th><th>Active</th><th>Actions</th></tr></thead>
            <tbody>
            @foreach(var item in Model) {
                <tr>
                    <td>@item.Code</td>
                    <td>@item.DiscountType</td>
                    <td>@(item.DiscountType == DiscountType.Percentage ? $"{item.DiscountValue}%" : item.DiscountValue.ToString("C"))</td>
                    <td>@item.IsActive</td>
                    <td>
                        <button class="btn btn-sm btn-warning edit-btn" data-id="@item.Id">Edit</button>
                        <button class="btn btn-sm btn-danger delete-btn" data-id="@item.Id">Delete</button>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
</div>

<!-- Add Modal -->
<div class="modal fade" id="addModal"><div class="modal-dialog"><div class="modal-content">
            <form asp-action="Create" method="post">
                <div class="modal-header"><h5 class="modal-title">Add Coupon</h5></div>
                <div class="modal-body">
                    <div class="form-group"><label>Code</label><input name="Code" class="form-control" required/></div>
                    <div class="form-group"><label>Discount Type</label><select name="DiscountType" asp-items="Html.GetEnumSelectList<DiscountType>()" class="form-control"></select></div>
                    <div class="form-group"><label>Discount Value</label><input name="DiscountValue" type="number" step="0.01" class="form-control" required/></div>
                    <div class="form-check"><input name="IsActive" value="true" type="checkbox" class="form-check-input" checked/><label>Is Active?</label></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button><button type="submit" class="btn btn-primary">Submit</button></div>
            </form>
        </div></div></div>

<!-- Edit Modal -->
<div class="modal fade" id="editModal"><div class="modal-dialog"><div class="modal-content">
            <form asp-action="Edit" method="post">
                <div class="modal-header"><h5 class="modal-title">Edit Coupon</h5></div>
                <div class="modal-body">
                    <input type="hidden" id="editId" name="Id" />
                    <div class="form-group"><label>Code</label><input id="editCode" name="Code" class="form-control" required/></div>
                    <div class="form-group"><label>Discount Type</label><select id="editDiscountType" name="DiscountType" asp-items="Html.GetEnumSelectList<DiscountType>()" class="form-control"></select></div>
                    <div class="form-group"><label>Discount Value</label><input id="editDiscountValue" name="DiscountValue" type="number" step="0.01" class="form-control" required/></div>
                    <div class="form-check"><input id="editIsActive" name="IsActive" value="true" type="checkbox" class="form-check-input"/><label>Is Active?</label></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button><button type="submit" class="btn btn-primary">Update</button></div>
            </form>
        </div></div></div>

<!-- Delete Modal -->
<div class="modal fade" id="deleteModal"><div class="modal-dialog"><div class="modal-content">
            <form asp-action="Delete" method="post">
                <div class="modal-header"><h5 class="modal-title">Confirm Deletion</h5></div>
                <div class="modal-body"><p>Are you sure you want to delete this coupon?</p><input type="hidden" id="deleteId" name="id" /></div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button><button type="submit" class="btn btn-danger">Delete</button></div>
            </form>
        </div></div></div>

@section Scripts {
    <script>
        $(function() {
            $('#couponTable').DataTable();
            $('.edit-btn').on('click', function() {
                $.getJSON('/Coupon/GetCoupon/' + $(this).data('id'), function(data) {
                    $('#editId').val(data.id);
                    $('#editCode').val(data.code);
                    $('#editDiscountType').val(data.discountType);
                    $('#editDiscountValue').val(data.discountValue);
                    $('#editIsActive').prop('checked', data.isActive);
                    $('#editModal').modal('show');
                });
            });
            $('.delete-btn').on('click', function() {
                $('#deleteId').val($(this).data('id'));
                $('#deleteModal').modal('show');
            });
        });
    </script>
}