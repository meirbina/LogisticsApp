@* @model SMS.Models.ViewModels.StateVM *@
@* *@
@* @{ *@
@* ViewData["Title"] = "States Setup"; *@
@* Layout = "~/Views/Shared/AdminLTE/_Layout.cshtml"; *@
@* int sl = 1; *@
@* } *@
@* *@
@* <!-- Notification Area --> *@
@* @if (TempData["success"] != null) { <div class="alert alert-success alert-dismissible fade show">@TempData["success"]<button type="button" class="close" data-dismiss="alert">&times;</button></div> } *@
@* @if (TempData["error"] != null) { <div class="alert alert-danger alert-dismissible fade show">@TempData["error"]<button type="button" class="close" data-dismiss="alert">&times;</button></div> } *@
@* *@
@* <div class="row"> *@
@*     <!-- Left Column: Add State --> *@
@*     <div class="col-md-4"> *@
@*         <div class="card card-primary"> *@
@*             <div class="card-header"><h3 class="card-title"><i class="fas fa-plus"></i> Add New State</h3></div> *@
@*             <form asp-action="Create" method="post"> *@
@*                 @Html.AntiForgeryToken() *@
@*                 <div class="card-body"> *@
@*                     <div asp-validation-summary="All" class="text-danger mb-2"></div> *@
@*                     <div class="form-group"> *@
@*                         <label asp-for="NewState.Name"></label> <span class="text-danger">*</span> *@
@*                         <input asp-for="NewState.Name" class="form-control" placeholder="Enter state name" /> *@
@*                         <span asp-validation-for="NewState.Name" class="text-danger"></span> *@
@*                     </div> *@
@*                 </div> *@
@*                 <div class="card-footer"> *@
@*                     <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save State</button> *@
@*                 </div> *@
@*             </form> *@
@*         </div> *@
@*     </div> *@
@* *@
@*     <!-- Right Column: State List --> *@
@*     <div class="col-md-8"> *@
@*         <div class="card card-info"> *@
@*             <div class="card-header"><h3 class="card-title"><i class="fas fa-list"></i> States List</h3></div> *@
@*             <div class="card-body"> *@
@*                 <table id="stateTable" class="table table-bordered table-striped"> *@
@*                     <thead> *@
@*                     <tr> *@
@*                         <th>Sl</th> *@
@*                         <th>State</th> *@
@*                         <th>In State?</th> *@
@*                         <th>Action</th> *@
@*                     </tr> *@
@*                     </thead> *@
@*                     <tbody> *@
@*                     @foreach (var item in Model.StateList) *@
@*                     { *@
@*                     <tr> *@
@*                         <td>@(sl++)</td> *@
@*                         <td>@item.Name</td> *@
@*                         <td> *@
@*                             @if (item.InState) *@
@*                             { *@
@*                             <span class="badge badge-success">True</span> *@
@*                             } *@
@*                             else *@
@*                             { *@
@*                             <span class="badge badge-secondary">False</span> *@
@*                             } *@
@*                         </td> *@
@*                         <td> *@
@*                             <button type="button" class="btn btn-sm btn-outline-primary editButton" data-id="@item.Id" data-toggle="modal" data-target="#editModal" title="Edit"><i class="fas fa-pencil-alt"></i> Edit</button> *@
@*                             <button type="button" class="btn btn-sm btn-outline-danger deleteButton" data-id="@item.Id" data-toggle="modal" data-target="#deleteModal" title="Delete"><i class="fas fa-trash"></i> Delete</button> *@
@*                         </td> *@
@*                     </tr> *@
@*                     } *@
@*                     </tbody> *@
@*                 </table> *@
@*             </div> *@
@*         </div> *@
@*     </div> *@
@* </div> *@
@* *@
@* <!-- ======================= MODALS ======================= --> *@
@* *@
@* <!-- Edit Modal --> *@
@* <div class="modal fade" id="editModal" tabindex="-1"> *@
@*     <div class="modal-dialog"> *@
@*         <div class="modal-content"> *@
@*             <form asp-action="Edit" method="post"> *@
@*                 @Html.AntiForgeryToken() *@
@*                 <input type="hidden" name="Id" id="edit_Id" /> *@
@*                 <div class="modal-header"> *@
@*                     <h5 class="modal-title">Edit State</h5> *@
@*                     <button type="button" class="close" data-dismiss="modal">&times;</button> *@
@*                 </div> *@
@*                 <div class="modal-body"> *@
@*                     <div class="form-group"> *@
@*                         <label>State Name</label> *@
@*                         <input name="Name" id="edit_Name" class="form-control" /> *@
@*                     </div> *@
@*                     <div class="form-group"> *@
@*                         <div class="custom-control custom-switch"> *@
@*                             <input type="hidden" name="InState" value="false" /> *@
@*                             <input type="checkbox" class="custom-control-input" name="InState" value="true" id="edit_InState"> *@
@*                             <label class="custom-control-label" for="edit_InState">Is Operational in this State?</label> *@
@*                         </div> *@
@*                     </div> *@
@*                 </div> *@
@*                 <div class="modal-footer"> *@
@*                     <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button> *@
@*                     <button type="submit" class="btn btn-primary">Update</button> *@
@*                 </div> *@
@*             </form> *@
@*         </div> *@
@*     </div> *@
@* </div> *@
@* *@
@* <!-- Delete Modal --> *@
@* <div class="modal fade" id="deleteModal" tabindex="-1"> *@
@*     <div class="modal-dialog"> *@
@*         <div class="modal-content"> *@
@*             <form asp-action="Delete" method="post"> *@
@*                 @Html.AntiForgeryToken() *@
@*                 <div class="modal-header bg-danger"><h5 class="modal-title">Confirm Delete</h5></div> *@
@*                 <div class="modal-body"> *@
@*                     <p>Are you sure you want to delete this state?</p> *@
@*                     <input type="hidden" id="delete_Id" name="id" /> *@
@*                 </div> *@
@*                 <div class="modal-footer"> *@
@*                     <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button> *@
@*                     <button type="submit" class="btn btn-danger">Delete</button> *@
@*                 </div> *@
@*             </form> *@
@*         </div> *@
@*     </div> *@
@* </div> *@
@* *@
@* @section Scripts { *@
@* <partial name="_ValidationScriptsPartial" /> *@
@* <script> *@
@*     $(function () { *@
@*         $('#stateTable').DataTable({ "responsive": true, "autoWidth": false }); *@
@* *@
@*         // Handle Edit Button Click *@
@*         $('.editButton').on('click', function () { *@
@*             var id = $(this).data('id'); *@
@*             $.ajax({ *@
@*                 url: `/State/GetState?id=${id}`, *@
@*                 type: 'GET', *@
@*                 success: function (data) { *@
@*                     if (data) { *@
@*                         $('#edit_Id').val(data.id); *@
@*                         $('#edit_Name').val(data.name); *@
@*                         $('#edit_InState').prop('checked', data.inState); *@
@*                     } *@
@*                 }, *@
@*                 error: function () { alert('Error fetching data.'); } *@
@*             }); *@
@*         }); *@
@* *@
@*         // Handle Delete Button Click *@
@*         $('.deleteButton').on('click', function () { *@
@*             var id = $(this).data('id'); *@
@*             $('#delete_Id').val(id); *@
@*         }); *@
@*     }); *@
@* </script> *@
@* } *@

















@model SMS.Models.ViewModels.StateVM

@{
ViewData["Title"] = "States Setup";
Layout = "~/Views/Shared/AdminLTE/_Layout.cshtml";
int sl = 1;
}

<!-- Notification Area -->
@if (TempData["success"] != null) { <div class="alert alert-success alert-dismissible fade show">@TempData["success"]<button type="button" class="close" data-dismiss="alert">&times;</button></div> }
@if (TempData["error"] != null) { <div class="alert alert-danger alert-dismissible fade show">@TempData["error"]<button type="button" class="close" data-dismiss="alert">&times;</button></div> }

<div class="row">
    <!-- Left Column: Add State -->
    <div class="col-md-4">
        <div class="card card-primary">
            <div class="card-header"><h3 class="card-title"><i class="fas fa-plus"></i> Add New State</h3></div>
            <form asp-action="Create" method="post">
                @Html.AntiForgeryToken()
                <div class="card-body">
                    <div asp-validation-summary="ModelOnly" class="text-danger mb-2"></div>
                    <div class="form-group">
                        <label asp-for="NewState.Name"></label> <span class="text-danger">*</span>
                        <input asp-for="NewState.Name" class="form-control" placeholder="Enter state name" />
                        <span asp-validation-for="NewState.Name" class="text-danger"></span>
                    </div>
                </div>
                <div class="card-footer">
                    <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save State</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Right Column: State List -->
    <div class="col-md-8">
        <div class="card card-info">
            <div class="card-header"><h3 class="card-title"><i class="fas fa-list"></i> States List</h3></div>
            <div class="card-body">
                <table id="stateTable" class="table table-bordered table-striped">
                    <thead>
                    <tr>
                        <th>Sl</th>
                        <th>State</th>
                        <th>In State?</th>
                        <th>Action</th>
                    </tr>
                    </thead>
                    <tbody>
                    @foreach (var item in Model.StateList)
                    {
                    <tr>
                        <td>@(sl++)</td>
                        <td>@item.Name</td>
                        <td>
                            @if (item.InState)
                            {
                            <span class="badge badge-success">True</span>
                            }
                            else
                            {
                            <span class="badge badge-secondary">False</span>
                            }
                        </td>
                        <td>
                            <button type="button" class="btn btn-sm btn-outline-primary editButton" data-id="@item.Id" data-toggle="modal" data-target="#editModal" title="Edit"><i class="fas fa-pencil-alt"></i> Edit</button>
                            <button type="button" class="btn btn-sm btn-outline-danger deleteButton" data-id="@item.Id" data-toggle="modal" data-target="#deleteModal" title="Delete"><i class="fas fa-trash"></i> Delete</button>
                        </td>
                    </tr>
                    }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- ======================= MODALS ======================= -->

<!-- Edit Modal -->
<div class="modal fade" id="editModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form asp-action="Edit" method="post">
                @Html.AntiForgeryToken()
                <input type="hidden" name="Id" id="edit_Id" />
                <div class="modal-header">
                    <h5 class="modal-title">Edit State</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>State Name</label>
                        <input name="Name" id="edit_Name" class="form-control" />
                    </div>
                    <div class="form-group">
                        <div class="custom-control custom-switch">
                            <!-- This hidden input ensures 'false' is sent if the checkbox is unchecked -->
                            <input type="hidden" name="InState" value="false" />
                            <input type="checkbox" class="custom-control-input" name="InState" value="true" id="edit_InState">
                            <label class="custom-control-label" for="edit_InState">Is Operational in this State?</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form asp-action="Delete" method="post">
                @Html.AntiForgeryToken()
                <div class="modal-header bg-danger"><h5 class="modal-title">Confirm Delete</h5></div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this state?</p>
                    <input type="hidden" id="delete_Id" name="id" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger">Delete</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
<partial name="_ValidationScriptsPartial" />
<script>
    $(function () {
        $('#stateTable').DataTable({ "responsive": true, "autoWidth": false });

        $('.editButton').on('click', function () {
            var id = $(this).data('id');
            $.ajax({
                url: `/State/GetState?id=${id}`,
                type: 'GET',
                success: function (data) {
                    if (data) {
                        $('#edit_Id').val(data.id);
                        $('#edit_Name').val(data.name);
                        $('#edit_InState').prop('checked', data.inState);
                    }
                },
                error: function () { alert('Error fetching data.'); }
            });
        });

        $('.deleteButton').on('click', function () {
            var id = $(this).data('id');
            $('#delete_Id').val(id);
        });
    });
</script>
}