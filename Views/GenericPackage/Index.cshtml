@model IEnumerable<SMS.Models.GenericPackage>
@{
    ViewData["Title"] = "Generic Package Setup";
    Layout = "~/Views/Shared/AdminLTE/_Layout.cshtml";
}

<div class="card shadow mb-4">
    <div class="card-header d-flex justify-content-between">
        <h6 class="m-0 font-weight-bold text-primary">Generic Package Pricing</h6>
        <button class="btn btn-primary" data-toggle="modal" data-target="#addModal">Add Package</button>
    </div>
    <div class="card-body">
        <table class="table table-bordered" id="packageTable">
            <thead><tr><th>Name</th><th>Regular Price</th><th>Merchant Price</th><th>Status</th><th>Actions</th></tr></thead>
            <tbody>
            @foreach(var item in Model) {
                <tr>
                    <td>@item.Name</td>
                    <td>@item.RegularPrice.ToString("C")</td>
                    <td>@item.MerchantPrice.ToString("C")</td>
                    <td>@(item.IsActive ? "Active" : "Inactive")</td>
                    <td>
                        <button class="btn btn-sm btn-warning edit-btn" data-id="@item.Id" data-toggle="modal" data-target="#editModal">Edit</button>
                        <button class="btn btn-sm btn-danger delete-btn" data-id="@item.Id" data-toggle="modal" data-target="#deleteModal">Delete</button>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
</div>

<!-- Add Modal -->
<div class="modal fade" id="addModal"><div class="modal-dialog"><div class="modal-content">
            <form asp-action="Create" method="post">
                <div class="modal-header"><h5 class="modal-title">Add Generic Package</h5></div>
                <div class="modal-body">
                    <div class="form-group"><label>Package Name</label><input name="Name" class="form-control" required/></div>
                    <div class="form-group"><label>Regular Price</label><input name="RegularPrice" type="number" step="0.01" class="form-control" required/></div>
                    <div class="form-group"><label>Merchant Price (Discounted)</label><input name="MerchantPrice" type="number" step="0.01" class="form-control" required/></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button><button type="submit" class="btn btn-primary">Save</button></div>
            </form>
        </div></div></div>

<!-- Edit Modal -->
<div class="modal fade" id="editModal"><div class="modal-dialog"><div class="modal-content">
            <form asp-action="Edit" method="post">
                <div class="modal-header"><h5 class="modal-title">Edit Generic Package</h5></div>
                <div class="modal-body">
                    <input type="hidden" id="editId" name="Id" />
                    <div class="form-group"><label>Package Name</label><input id="editName" name="Name" class="form-control" required/></div>
                    <div class="form-group"><label>Regular Price</label><input id="editRegularPrice" name="RegularPrice" type="number" step="0.01" class="form-control" required/></div>
                    <div class="form-group"><label>Merchant Price</label><input id="editMerchantPrice" name="MerchantPrice" type="number" step="0.01" class="form-control" required/></div>
                    <div class="form-check"><input id="editIsActive" name="IsActive" value="true" type="checkbox" class="form-check-input"/><label class="form-check-label" for="editIsActive">Is Active?</label></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button><button type="submit" class="btn btn-primary">Update</button></div>
            </form>
        </div></div></div>

<!-- Delete Modal -->
<div class="modal fade" id="deleteModal"><div class="modal-dialog"><div class="modal-content">
            <form asp-action="Delete" method="post">
                <div class="modal-header"><h5 class="modal-title">Confirm Deletion</h5></div>
                <div class="modal-body"><p>Are you sure you want to delete this package?</p><input type="hidden" id="deleteId" name="Id" /></div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button><button type="submit" class="btn btn-danger">Delete</button></div>
            </form>
        </div></div></div>

@section Scripts {
    <script>
        $(function() {
            $('#packageTable').DataTable();
            $('.edit-btn').on('click', function() {
                $.getJSON('/GenericPackage/GetPackage/' + $(this).data('id'), function(data) {
                    $('#editId').val(data.id); $('#editName').val(data.name);
                    $('#editRegularPrice').val(data.regularPrice); $('#editMerchantPrice').val(data.merchantPrice);
                    $('#editIsActive').prop('checked', data.isActive);
                });
            });
            $('.delete-btn').on('click', function() {
                $('#deleteId').val($(this).data('id'));
            });
        });
    </script>
}